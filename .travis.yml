language: python
branches:
  only:
    - main
services:
  - docker
install:
  - pip install pytest codecov
  - travis_fold start "Build.Image" && docker build . -t mock && docker image ls mock && travis_fold end "Build.Image"
script:
  - stty cols 120
  - travis_fold start "Unit.Tests" && travis_fold end "Unit.Tests"
  - travis_fold start "Integration.Tests" && docker run -d -p 8000-8010:8000-8010 -v `pwd`:/tmp mock && sleep 5 && curl --fail -v http://localhost:8000 && travis_fold end "Integration.Tests"
after_success:
  - codecov
after_failure:
  - cat server.log  # the log from container
